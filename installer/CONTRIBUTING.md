# Contributing to MassaStation Installers

Thank you for considering contributing to MassaStation Installers! We welcome any contributions from the community and value the time you spend to help us improve our products.

## Getting Started

To contribute to MassaStation Installers, you need to have a basic understanding of the used tools to build installers on a given operating system. The following tools are used to build installers:

- [Wix Toolset](https://wixtoolset.org/) for Windows
- `pkgbuild` and `productbuild` for macOS
- [dpkg-deb](https://www.debian.org/doc/debian-policy/index.html) for Debian-based Linux distributions

If you are new to contributing to open source projects, we recommend reading [GitHub's guide to contributing](https://guides.github.com/activities/contributing-to-open-source/).

This directory contains a directory for each installer type. Each directory contains a script to build the installer for the given operating system and a `scripts` directory with scripts that will be executed during the installation process.

### Windows

For Windows, we are using [Wix](https://wixtoolset.org/) to build the installer. This tool generates a `.msi` file, which is the standard installer format for Windows.

#### Requirements

This script must be executed on a Windows machine and requires Python 3.10 or higher to be installed on your system.

#### Building the installer

The installer is built using the `build_installer.py` script in the `windows` directory. The script can be executed with the following command:

```bash
python windows/build_installer.py
```

#### Wix

The installer is defined by the `XML` that is generated by the `create_wxs_file` function.

This `XML` contains the following sections:

- `Product`: Defines the product name, version, manufacturer, and upgrade code.
- `Package`: Defines the installer version, and installer type.
- `UI`: Defines the user interface of the installer.
- `Directory`: Defines the installation directories.
- `CustomAction`: Defines the custom actions that are executed during the installation process. Most of those actions are `.bat` scripts that are executed during the installation process.
- `InstallExecuteSequence`: Defines the order of execution of the custom actions.

For more information about the `XML` structure, please refer to the [Wix documentation](https://wixtoolset.org/docs/intro/).

### MacOS

For macOS, we are using the `pkgbuild` and `productbuild` tools to build the installer. This tool generates a `.pkg` file, which is the standard installer format for macOS.

#### Requirements

This script must be executed on a MacOS machine and requires `pkgbuild` and `productbuild` to be installed on your system.

#### Building the installer

The installer is built using the `create_pkg.sh` script in the `macos` directory. It can be used to build the installer for `amd64` and `arm64` architectures. The script can be executed with the following command:

```bash
./macos/create_pkg.sh <architecture> <APPLE_DEVELOPER_ID_APPLICATION> <APPLE_DEVELOPER_ID_INSTALLER>
```

The `APPLE_DEVELOPER_ID_APPLICATION` and `APPLE_DEVELOPER_ID_INSTALLER` are optional, and are used to sign the application and the installer.

#### `pkgbuild`

The `scripts` directory contains scripts that will be executed during the installation process. The `postinstall` script will be executed after the installation process is finished. It is possible to add additional scripts to the `scripts` directory such as `preinstall`, that will be executed before the installation process starts, or any other script that must be called by `postinstall` or `preinstall` scripts to be executed during the installation process.

### Debian-based Linux distributions

For Debian-based Linux distributions, we are using the `dpkg-deb` tool to build the installer. This tool generates a `.deb` file, which is the standard installer format for Debian-based Linux distributions.

#### Requirements

This script must be executed on a Debian-based Linux distribution.

#### Building the installer

The installer is built using the `create_deb.sh` script in the `deb` directory. The script can be executed with the following command:

```bash
./deb/create_deb.sh
```

#### `dpkg-deb`

The package is defined by the `control` file that is generated in the `main` function of the `create_deb.sh` script. This file contains multiple sections that define the package name, version, dependencies, and more. For more information about the `control` file, please refer to this [documentation](https://www.debian.org/doc/debian-policy/ch-controlfields.html).

The `scripts` directory contains scripts that will be executed during the installation process. The `postinst` script will be executed after the installation process is finished. It is possible to add additional scripts to the `scripts` directory such as `preinst`, `prerm`, `postrm` and more (a list of all available scripts can be found [here](https://www.debian.org/doc/debian-policy/ch-maintainerscripts.html#summary-of-ways-maintainer-scripts-are-called)).

For more information about the `dpkg-deb` tool, please refer to [Debian's documentation](https://www.debian.org/doc/debian-policy/index.html).

## Other information

Most of the information about contributing to MassaStation can be found in the [MassaStation Contributing Guide](https://github.com/massalabs/station/blob/main/CONTRIBUTING.md).
