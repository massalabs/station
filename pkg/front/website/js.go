// GENERATED BY textFileToGoConst
// GitHub:     github.com/logrusorgru/textFileToGoConst
// input file: html/front/website.js
// generated:  Wed Sep 28 18:01:50 CEST 2022

package website

const JS = "let gWallets = [];\nlet deployers = [];\nlet actualTxType = '';\nlet nextFileToUpload;\nlet uploadable = false;\n\n// INIT\ngetWallets();\ngetWebsiteDeployerSC();\ninitializeDefaultWallet();\nsetupModal();\n\nconst eventManager = new EventManager();\n\n// Write the default wallet text in wallet popover component\nasync function getWebsiteDeployerSC() {\n\tlet defaultWallet = getDefaultWallet();\n\n\t$('#website-deployers-table tbody tr').remove();\n\n\taxios\n\t\t.get('/my/domains/' + defaultWallet)\n\t\t.then((websites) => {\n\t\t\tlet count = 0;\n\t\t\tfor (const website of websites.data) {\n\t\t\t\ttableInsert(website, count);\n\t\t\t\tcount++;\n\t\t\t}\n\t\t\tdeployers = websites.data;\n\t\t})\n\t\t.catch((e) => {\n\t\t\tconsole.error(e);\n\t\t\terrorAlert(getErrorMessage(e.response.data.code));\n\t\t});\n}\n\n// Write the default wallet text in wallet popover component\nfunction initializeDefaultWallet() {\n\tlet defaultWallet = getDefaultWallet();\n\tif (defaultWallet === '') {\n\t\tdefaultWallet = 'Connect';\n\t}\n\t$('.popover__title').html(defaultWallet);\n}\n\n// Retrieve the default wallet nickname in cookies\nfunction getDefaultWallet() {\n\tlet defaultWallet = '';\n\tconst cookies = document.cookie.split(';');\n\tcookies.forEach((cookie) => {\n\t\tconst keyValue = cookie.split('=');\n\t\tif (keyValue[0] === 'defaultWallet') {\n\t\t\tdefaultWallet = keyValue[1];\n\t\t}\n\t});\n\treturn defaultWallet;\n}\n\nfunction getWallet(nickname) {\n\treturn gWallets.find((w) => w.nickname === nickname);\n}\n\nfunction getDeployerByDns(dns) {\n\treturn deployers.find((c) => c.name === dns);\n}\n\nfunction setupModal() {\n\t$('#passwordModal').on('shown.bs.modal', function () {\n\t\t$('#passwordModal').trigger('focus');\n\t});\n}\n\nfunction setTxType(txType) {\n\tactualTxType = txType;\n}\n\nasync function callTx() {\n\tconst passwordValue = $('#walletPassword').val();\n\n\tif (actualTxType === 'deployWebsiteAndUpload') {\n\t\tdeployWebsiteAndUpload(passwordValue);\n\t}\n\tif (actualTxType.includes('uploadWebsiteCreator')) {\n\t\tconst websiteIndex = actualTxType.split('uploadWebsiteCreator')[1];\n\t\tuploadWebsite(nextFileToUpload, websiteIndex, passwordValue);\n\t}\n}\n\n// open file upload\nfunction openDialog() {\n\tdocument.getElementById('fileid0').value = null;\n\tdocument.getElementById('fileid0').click();\n}\n\n// Handle event on file selecting\nfunction handleFileSelect(evt) {\n\tlet files = evt.target.files; // get files\n\tlet f = files[0];\n\tconst reader = new FileReader();\n\treader.onload = (event) => importWallet(JSON.parse(event.target.result)); // desired file content\n\treader.onerror = (error) => reject(error);\n\treader.readAsText(f);\n}\n\n// Append wallet accounts in popover component list\nasync function feedWallet(w) {\n\tlet counter = 0;\n\tfor (const wallet of w) {\n\t\t$('#wallet-list').append(\n\t\t\t\"<li class='wallet-item'><a class='wallet-link' id='wallet-link-\" +\n\t\t\t\tcounter +\n\t\t\t\t\"' onclick='changeDefaultWallet(event)' href='#'>\" +\n\t\t\t\twallet.nickname +\n\t\t\t\t'</a></li>'\n\t\t);\n\t\tcounter++;\n\t}\n}\n\n// Handle popover click & update default wallet in cookies\nfunction changeDefaultWallet(event) {\n\tconst idElementClicked = event.target.id;\n\tconst newDefaultWalletId = idElementClicked.split('-')[2];\n\tconst walletName = gWallets[newDefaultWalletId].nickname;\n\n\tdocument.cookie = 'defaultWallet=' + walletName;\n\t$('.popover__title').html(walletName);\n\n\tgetWebsiteDeployerSC();\n}\n\nasync function getWallets() {\n\taxios\n\t\t.get('/mgmt/wallet')\n\t\t.then((resp) => {\n\t\t\tif (resp) {\n\t\t\t\tgWallets = resp.data;\n\t\t\t\tfeedWallet(gWallets);\n\t\t\t}\n\t\t})\n\t\t.catch((e) => {\n\t\t\terrorAlert(getErrorMessage(e.response.data.code));\n\t\t});\n}\n\nfunction tableInsert(resp, count) {\n\tconst tBody = document.getElementById('website-deployers-table').getElementsByTagName('tbody')[0];\n\tconst row = tBody.insertRow(-1);\n\tconst url = 'http://' + resp.name + '.massa/';\n\n\tconst cell0 = row.insertCell();\n\tconst cell1 = row.insertCell();\n\tconst cell2 = row.insertCell();\n\tconst cell3 = row.insertCell();\n\n\tcell0.innerHTML = resp.name;\n\tcell1.innerHTML = addressInnerHTML(resp.address);\n\tcell2.innerHTML = `<a href=\"${url}\" target=\"_blank\" rel=\"noopener noreferrer\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" class=\"bi bi-globe2\" viewBox=\"0 0 16 16\"><path d=\"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm7.5-6.923c-.67.204-1.335.82-1.887 1.855-.143.268-.276.56-.395.872.705.157 1.472.257 2.282.287V1.077zM4.249 3.539c.142-.384.304-.744.481-1.078a6.7 6.7 0 0 1 .597-.933A7.01 7.01 0 0 0 3.051 3.05c.362.184.763.349 1.198.49zM3.509 7.5c.036-1.07.188-2.087.436-3.008a9.124 9.124 0 0 1-1.565-.667A6.964 6.964 0 0 0 1.018 7.5h2.49zm1.4-2.741a12.344 12.344 0 0 0-.4 2.741H7.5V5.091c-.91-.03-1.783-.145-2.591-.332zM8.5 5.09V7.5h2.99a12.342 12.342 0 0 0-.399-2.741c-.808.187-1.681.301-2.591.332zM4.51 8.5c.035.987.176 1.914.399 2.741A13.612 13.612 0 0 1 7.5 10.91V8.5H4.51zm3.99 0v2.409c.91.03 1.783.145 2.591.332.223-.827.364-1.754.4-2.741H8.5zm-3.282 3.696c.12.312.252.604.395.872.552 1.035 1.218 1.65 1.887 1.855V11.91c-.81.03-1.577.13-2.282.287zm.11 2.276a6.696 6.696 0 0 1-.598-.933 8.853 8.853 0 0 1-.481-1.079 8.38 8.38 0 0 0-1.198.49 7.01 7.01 0 0 0 2.276 1.522zm-1.383-2.964A13.36 13.36 0 0 1 3.508 8.5h-2.49a6.963 6.963 0 0 0 1.362 3.675c.47-.258.995-.482 1.565-.667zm6.728 2.964a7.009 7.009 0 0 0 2.275-1.521 8.376 8.376 0 0 0-1.197-.49 8.853 8.853 0 0 1-.481 1.078 6.688 6.688 0 0 1-.597.933zM8.5 11.909v3.014c.67-.204 1.335-.82 1.887-1.855.143-.268.276-.56.395-.872A12.63 12.63 0 0 0 8.5 11.91zm3.555-.401c.57.185 1.095.409 1.565.667A6.963 6.963 0 0 0 14.982 8.5h-2.49a13.36 13.36 0 0 1-.437 3.008zM14.982 7.5a6.963 6.963 0 0 0-1.362-3.675c-.47.258-.995.482-1.565.667.248.92.4 1.938.437 3.008h2.49zM11.27 2.461c.177.334.339.694.482 1.078a8.368 8.368 0 0 0 1.196-.49 7.01 7.01 0 0 0-2.275-1.52c.218.283.418.597.597.932zm-.488 1.343a7.765 7.765 0 0 0-.395-.872C9.835 1.897 9.17 1.282 8.5 1.077V4.09c.81-.03 1.577-.13 2.282-.287z\"/></svg></a>`;\n\tcell3.innerHTML =\n\t\t\"<div><input id='fileid\" +\n\t\tcount +\n\t\t\"' type='file' hidden/><button id='upload-website\" +\n\t\tcount +\n\t\t\"' class='primary-button' type='button' value='Upload MB' >Edit</button><img src='./logo.png' style='display: none' class='massa-logo-spinner loading\" +\n\t\tcount +\n\t\t\" alt='Massa logo' /></span></div>\";\n\n\tdocument.getElementById(`upload-website${count}`).addEventListener('click', function () {\n\t\tdocument.getElementById(`fileid${count}`).value = null;\n\t\tdocument.getElementById(`fileid${count}`).click();\n\t});\n\n\tdocument.getElementById(`fileid${count}`).addEventListener('change', function (evt) {\n\t\tlet files = evt.target.files; // get files\n\t\tnextFileToUpload = files[0];\n\n\t\tsetTxType('uploadWebsiteCreator' + count);\n\t\t$('#passwordModal').modal('show');\n\t});\n}\n\n$('#file-select-button').click(function () {\n\t$('.upload input').click();\n});\n\n// change button text with file name\n$('.upload input').on('change', function () {\n\tlet str = $('.upload input').val();\n\n\tlet n = str.lastIndexOf('\\\\');\n\n\tlet result = str.substring(n + 1);\n\n\t$('#file-select-button').html(result);\n});\n\n//check if file is .zip\n$('.upload input').on('change', function () {\n\tlet str = $('.upload input').val();\n\n\tlet n = str.lastIndexOf('.');\n\n\tlet result = str.substring(n + 1);\n\n\tif (result != 'zip' && $('.upload input').val() != '') {\n\t\tuploadable = false;\n\n\t\tdocument.getElementsByClassName('fileError')[0].style.display = 'flex';\n\t\tdocument.getElementById('website-upload').style.display = 'none';\n\t\tdocument.getElementById('website-upload-refuse').style.display = 'flex';\n\t} else {\n\t\tuploadable = true;\n\t\tdocument.getElementsByClassName('fileError')[0].style.display = 'none';\n\t\tdocument.getElementById('website-upload').style.display = 'flex';\n\t\tdocument.getElementById('website-upload-refuse').style.display = 'none';\n\t}\n});\n\n//remove label of input website name on focus\n$('.website-dns input').on('focus', function () {\n\tdocument.getElementById('website-info-display').style.visibility = 'hidden';\n});\n\n//check if input string is valid\n$('.website-dns input').on('change', function () {\n\tlet str = $('.website-dns input').val();\n\tlet pattern = new RegExp('^[a-z0-9]+$');\n\tlet testPattern = pattern.test(str);\n\n\tif (testPattern == false) {\n\t\tuploadable = false;\n\t\tdocument.getElementsByClassName('dns-error')[0].style.display = 'flex';\n\t\tdocument.getElementById('website-upload').style.display = 'none';\n\t\tdocument.getElementById('website-upload-refuse').style.display = 'flex';\n\t} else {\n\t\tuploadable = true;\n\t\tdocument.getElementsByClassName('dns-error')[0].style.display = 'none';\n\t\tdocument.getElementById('website-upload').style.display = 'flex';\n\t\tdocument.getElementById('website-upload-refuse').style.display = 'none';\n\t}\n});\n\nfunction uploadProcess(file, dnsName, isFullProcess, bodyFormData, callback) {\n\tdocument.getElementById('wallet-popover').classList.add('popover__disabled');\n\tconst reader = new FileReader();\n\treader.readAsDataURL(file);\n\treader.onloadend = (_) => {\n\t\tconst result = reader.result.length;\n\n\t\tconst chunkSize = Math.floor(result / 260_000) + 1;\n\n\t\tstepper(dnsName, chunkSize, isFullProcess);\n\n\t\tcallback(bodyFormData);\n\t};\n}\n\nfunction postUpload(bodyFormData, password) {\n\taxios({\n\t\turl: `/websiteCreator/upload`,\n\t\tmethod: 'POST',\n\t\tdata: bodyFormData,\n\t\theaders: {\n\t\t\t'Content-Type': 'multipart/form-data',\n\t\t\tAuthorization: password,\n\t\t},\n\t})\n\t\t.then((operation) => {\n\t\t\tsuccessMessage('Website uploaded to address : ' + operation.data.address);\n\t\t})\n\t\t.catch((e) => {\n\t\t\terrorAlert(getErrorMessage(e.response.data.code));\n\t\t\tresetStepper();\n\t\t});\n}\n\nfunction putUpload(bodyFormData, password) {\n\taxios({\n\t\turl: `/websiteCreator/prepare`,\n\t\tmethod: 'put',\n\t\tdata: bodyFormData,\n\t\theaders: {\n\t\t\t'Content-Type': 'multipart/form-data',\n\t\t\tAuthorization: password,\n\t\t},\n\t})\n\t\t.then((operation) => {\n\t\t\tsuccessMessage('Website uploaded to address : ' + operation.data.address);\n\t\t\tgetWebsiteDeployerSC();\n\t\t})\n\t\t.catch((e) => {\n\t\t\terrorAlert(getErrorMessage(e.response.data.code));\n\t\t\tresetStepper();\n\t\t});\n}\n\n// Full deployment process\nfunction deployWebsiteAndUpload(password) {\n\tconst dnsNameInputValue = document.getElementById('websiteName').value;\n\n\tconst file = document.querySelector('.upload input').files[0];\n\tconst bodyFormData = new FormData();\n\tbodyFormData.append('url', dnsNameInputValue);\n\tbodyFormData.append('nickname', getDefaultWallet());\n\tbodyFormData.append('zipfile', file);\n\n\tuploadProcess(file, dnsNameInputValue, true, bodyFormData, (bodyFormData) =>\n\t\tputUpload(bodyFormData, password)\n\t);\n}\n\n// Full deployment process\nfunction uploadWebsite(file, count, password) {\n\tconst bodyFormData = new FormData();\n\n\tconst address = deployers[count].address;\n\tbodyFormData.append('zipfile', file);\n\tbodyFormData.append('address', address);\n\tbodyFormData.append('nickname', getDefaultWallet());\n\n\tuploadProcess(file, deployers[count].name, false, bodyFormData, (bodyFormData) =>\n\t\tpostUpload(bodyFormData, password)\n\t);\n}\n\nasync function stepper(dnsName, totalChunk, isFullProcess) {\n\tinitStepper(dnsName, totalChunk);\n\n\tif (isFullProcess) {\n\t\tstep1(dnsName, totalChunk);\n\t} else {\n\t\t$('.circle').eq(0).empty();\n\t\t$('.circle').eq(0).append('<i class=\"bi bi-check\">');\n\t\t$('.title').eq(0).removeClass('loading-dots');\n\t\tstep3(getDeployerByDns(dnsName).address, totalChunk);\n\t}\n}\n\nfunction initStepper(dnsName, totalChunk) {\n\t$('.website-card').hide();\n\t$('.stepper').show();\n\n\t$('.stepper-title').html('Deployment of ' + dnsName);\n\t$('.title').eq(0).addClass('loading-dots');\n\n\t$('.title')\n\t\t.eq(2)\n\t\t.text('Chunk upload ' + 1 + ' on ' + totalChunk);\n}\n\n// Step 1, wait for contract deployment\nfunction step1(dnsName, totalChunk) {\n\teventManager.subscribe(\n\t\t`Website Deployer is deployed at :`,\n\t\tgetWallet(getDefaultWallet()).address,\n\t\t(resp) => step2(dnsName, resp.data.data.split(':')[1], totalChunk)\n\t);\n}\n\n// Step 2, wait for DNS setting\nfunction step2(dnsName, contractAddress, totalChunk) {\n\teventManager.subscribe(\n\t\t`Resolver set to record key :record${dnsName}at address `,\n\t\tgetWallet(getDefaultWallet()).address,\n\t\t(_) => {\n\t\t\tstep3(contractAddress, totalChunk);\n\t\t}\n\t);\n\n\t$('.circle').eq(0).empty();\n\t$('.circle').eq(0).append('<i class=\"bi bi-check\">');\n\n\t$('.title').eq(0).removeClass('loading-dots');\n\t$('.title').eq(1).addClass('loading-dots');\n}\n// Step 3, Monitor state of chunk uploding\nfunction step3(contractAddress, totalChunk) {\n\tlet actualChunk = 1;\n\n\tfor (let i = 0; i < totalChunk; i++) {\n\t\tif (i === 0) {\n\t\t\teventManager.subscribe(\n\t\t\t\t`First chunk deployed to ${contractAddress}`,\n\t\t\t\tgetWallet(getDefaultWallet()).address,\n\t\t\t\t(_) => {\n\t\t\t\t\tactualChunk++;\n\t\t\t\t\t$('.title')\n\t\t\t\t\t\t.eq(2)\n\t\t\t\t\t\t.text('Chunk upload ' + actualChunk + ' on ' + totalChunk);\n\t\t\t\t\t$('.title').eq(2).addClass('loading-dots');\n\n\t\t\t\t\tif (totalChunk === 1) {\n\t\t\t\t\t\tresetStepper();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t} else if (i == totalChunk - 1) {\n\t\t\teventManager.subscribe(\n\t\t\t\t`Append chunk deployed to ${contractAddress} : ${totalChunk - 1}`,\n\t\t\t\tgetWallet(getDefaultWallet()).address,\n\t\t\t\t(_) => {\n\t\t\t\t\tresetStepper();\n\t\t\t\t}\n\t\t\t);\n\t\t} else {\n\t\t\teventManager.subscribe(\n\t\t\t\t`Append chunk deployed to ${contractAddress} : ${i}`,\n\t\t\t\tgetWallet(getDefaultWallet()).address,\n\t\t\t\t(_) => {\n\t\t\t\t\tactualChunk++;\n\t\t\t\t\t$('.title')\n\t\t\t\t\t\t.eq(2)\n\t\t\t\t\t\t.text('Chunk upload ' + actualChunk + ' on ' + totalChunk);\n\t\t\t\t\t$('.title').eq(2).addClass('loading-dots');\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\t$('.circle').eq(1).empty();\n\t$('.circle').eq(1).append('<i class=\"bi bi-check\">');\n\n\t$('.title').eq(1).removeClass('loading-dots');\n\t$('.title').eq(2).addClass('loading-dots');\n}\n\nfunction resetStepper() {\n\t$('.website-card').show();\n\t$('.stepper').hide();\n\n\t$('.circle').empty();\n\t$('.circle').eq(0).html('1');\n\t$('.circle').eq(1).html('2');\n\t$('.circle').eq(2).html('3');\n\n\t$('.title').eq(2).html('Chunk upload');\n\n\t$('.title').eq(2).removeClass('loading-dots');\n\tgetWebsiteDeployerSC();\n\tdocument.getElementById('wallet-popover').classList.remove('popover__disabled');\n}\n"
