// GENERATED BY textFileToGoConst
// GitHub:     github.com/logrusorgru/textFileToGoConst
// input file: html\front\website.js
// generated:  Tue Sep 20 12:32:00 CEST 2022

package website

const JS = "let gWallets = [];\r\nlet deployers = [];\r\nlet actualTxType = '';\r\nlet nextFileToUpload;\r\nlet uploadable = false;\r\n\r\n// INIT\r\ngetWallets();\r\ngetWebsiteDeployerSC();\r\ninitializeDefaultWallet();\r\nsetupModal();\r\n\r\nconst eventManager = new EventManager();\r\n\r\n// Write the default wallet text in wallet popover component\r\nasync function getWebsiteDeployerSC() {\r\n\tlet defaultWallet = getDefaultWallet();\r\n\r\n\t$('#website-deployers-table tbody tr').remove();\r\n\r\n\taxios\r\n\t\t.get('/my/domains/' + defaultWallet)\r\n\t\t.then((websites) => {\r\n\t\t\tlet count = 0;\r\n\t\t\tfor (const website of websites.data) {\r\n\t\t\t\ttableInsert(website, count);\r\n\t\t\t\tcount++;\r\n\t\t\t}\r\n\t\t\tdeployers = websites.data;\r\n\t\t})\r\n\t\t.catch((e) => {\r\n\t\t\terrorAlert(getErrorMessage(e.response.data.code));\r\n\t\t});\r\n}\r\n\r\n// Write the default wallet text in wallet popover component\r\nfunction initializeDefaultWallet() {\r\n\tlet defaultWallet = getDefaultWallet();\r\n\tif (defaultWallet === '') {\r\n\t\tdefaultWallet = 'Connect';\r\n\t}\r\n\t$('.popover__title').html(defaultWallet);\r\n}\r\n\r\n// Retrieve the default wallet nickname in cookies\r\nfunction getDefaultWallet() {\r\n\tlet defaultWallet = '';\r\n\tconst cookies = document.cookie.split(';');\r\n\tcookies.forEach((cookie) => {\r\n\t\tconst keyValue = cookie.split('=');\r\n\t\tif (keyValue[0] === 'defaultWallet') {\r\n\t\t\tdefaultWallet = keyValue[1];\r\n\t\t}\r\n\t});\r\n\treturn defaultWallet;\r\n}\r\n\r\nfunction getWallet(nickname) {\r\n\treturn gWallets.find((w) => w.nickname === nickname);\r\n}\r\n\r\nfunction getDeployerByAddress(contractAddress) {\r\n\treturn deployers.find((c) => c.address === contractAddress);\r\n}\r\n\r\nfunction getDeployerByDns(dns) {\r\n\treturn deployers.find((c) => c.name === dns);\r\n}\r\n\r\nfunction setupModal() {\r\n\t$('#passwordModal').on('shown.bs.modal', function () {\r\n\t\t$('#passwordModal').trigger('focus');\r\n\t});\r\n}\r\n\r\nfunction setTxType(txType) {\r\n\tactualTxType = txType;\r\n}\r\n\r\nasync function callTx() {\r\n\tconst passwordValue = $('#walletPassword').val();\r\n\r\n\tif (actualTxType === 'deployWebsiteAndUpload') {\r\n\t\tdeployWebsiteAndUpload(passwordValue);\r\n\t}\r\n\tif (actualTxType.includes('uploadWebsiteCreator')) {\r\n\t\tconst websiteIndex = actualTxType.split('uploadWebsiteCreator')[1];\r\n\t\tuploadWebsite(nextFileToUpload, websiteIndex, passwordValue);\r\n\t}\r\n}\r\n\r\n// open file upload\r\nfunction openDialog() {\r\n\tdocument.getElementById('fileid0').value = null;\r\n\tdocument.getElementById('fileid0').click();\r\n}\r\n\r\n// Handle event on file selecting\r\nfunction handleFileSelect(evt) {\r\n\tlet files = evt.target.files; // get files\r\n\tlet f = files[0];\r\n\tconst reader = new FileReader();\r\n\treader.onload = (event) => importWallet(JSON.parse(event.target.result)); // desired file content\r\n\treader.onerror = (error) => reject(error);\r\n\treader.readAsText(f);\r\n}\r\n\r\nfunction errorAlert(error) {\r\n\tdocument.getElementsByClassName('alert-danger')[0].style.display = 'block';\r\n\tdocument.getElementsByClassName('alert-danger')[0].innerHTML = error;\r\n\tsetTimeout(function () {\r\n\t\tdocument.getElementsByClassName('alert-danger')[0].style.display = 'none';\r\n\t}, 5000);\r\n}\r\n\r\nfunction successMessage(message) {\r\n\tdocument.getElementsByClassName('alert-primary')[0].style.display = 'block';\r\n\tdocument.getElementsByClassName('alert-primary')[0].innerHTML = message;\r\n\tsetTimeout(function () {\r\n\t\tdocument.getElementsByClassName('alert-primary')[0].style.display = 'none';\r\n\t}, 5000);\r\n}\r\n\r\n// Append wallet accounts in popover component list\r\nasync function feedWallet(w) {\r\n\tlet counter = 0;\r\n\tfor (const wallet of w) {\r\n\t\t$('#wallet-list').append(\r\n\t\t\t\"<li class='wallet-item'><a class='wallet-link' id='wallet-link-\" +\r\n\t\t\t\tcounter +\r\n\t\t\t\t\"' onclick='changeDefaultWallet(event)' href='#'>\" +\r\n\t\t\t\twallet.nickname +\r\n\t\t\t\t'</a></li>'\r\n\t\t);\r\n\t\tcounter++;\r\n\t}\r\n}\r\n\r\n// Handle popover click & update default wallet in cookies\r\nfunction changeDefaultWallet(event) {\r\n\tconst idElementClicked = event.target.id;\r\n\tconst newDefaultWalletId = idElementClicked.split('-')[2];\r\n\tconst walletName = gWallets[newDefaultWalletId].nickname;\r\n\r\n\tdocument.cookie = 'defaultWallet=' + walletName;\r\n\t$('.popover__title').html(walletName);\r\n\r\n\tgetWebsiteDeployerSC();\r\n}\r\n\r\nasync function getWallets() {\r\n\taxios\r\n\t\t.get('/mgmt/wallet')\r\n\t\t.then((resp) => {\r\n\t\t\tif (resp) {\r\n\t\t\t\tgWallets = resp.data;\r\n\t\t\t\tfeedWallet(gWallets);\r\n\t\t\t}\r\n\t\t})\r\n\t\t.catch((e) => {\r\n\t\t\terrorAlert(getErrorMessage(e.response.data.code));\r\n\t\t});\r\n}\r\n\r\nfunction tableInsert(resp, count) {\r\n\tconst tBody = document.getElementById('website-deployers-table').getElementsByTagName('tbody')[0];\r\n\tconst row = tBody.insertRow(-1);\r\n\tconst url = 'http://' + resp.name + '.massa/';\r\n\r\n\tconst cell0 = row.insertCell();\r\n\tconst cell1 = row.insertCell();\r\n\tconst cell2 = row.insertCell();\r\n\tconst cell3 = row.insertCell();\r\n\r\n\tcell0.innerHTML = resp.name;\r\n\tcell1.innerHTML = resp.address;\r\n\tcell2.innerHTML =\r\n\t\t\"<a href='\" + url + \"'target = '_blank' rel='noopener noreferrer'>\" + url + '</a>';\r\n\tcell3.innerHTML =\r\n\t\t\"<div><input id='fileid\" +\r\n\t\tcount +\r\n\t\t\"' type='file' hidden/><button id='upload-website\" +\r\n\t\tcount +\r\n\t\t\"' class='primary-button' id='buttonid' type='button' value='Upload MB' >Edit</button><img src='./logo.png' style='display: none' class='massa-logo-spinner loading\" +\r\n\t\tcount +\r\n\t\t\" alt='Massa logo' /></span></div>\";\r\n\r\n\tdocument.getElementById(`upload-website${count}`).addEventListener('click', function () {\r\n\t\tdocument.getElementById(`fileid${count}`).value = null;\r\n\t\tdocument.getElementById(`fileid${count}`).click();\r\n\t});\r\n\r\n\tdocument.getElementById(`fileid${count}`).addEventListener('change', function (evt) {\r\n\t\tlet files = evt.target.files; // get files\r\n\t\tnextFileToUpload = files[0];\r\n\r\n\t\tsetTxType('uploadWebsiteCreator' + count);\r\n\t\t$('#passwordModal').modal('show');\r\n\t});\r\n}\r\n\r\nfunction uploadWebsite(file, count, password) {\r\n\tlet defaultWallet = getDefaultWallet();\r\n\tconst bodyFormData = new FormData();\r\n\r\n\tbodyFormData.append('zipfile', file);\r\n\tbodyFormData.append('address', deployers[count].address);\r\n\tbodyFormData.append('nickname', defaultWallet);\r\n\r\n\tconst reader = new FileReader();\r\n\treader.readAsDataURL(file);\r\n\treader.onloadend = (_) => {\r\n\t\tconst result = reader.result.length;\r\n\r\n\t\tconst chunkSize = Math.floor(result / 260_000) + 1;\r\n\r\n\t\tstepper(getDeployerByAddress(address).name, chunkSize, false);\r\n\r\n\t\taxios({\r\n\t\t\turl: `/websiteCreator/upload`,\r\n\t\t\tmethod: 'POST',\r\n\t\t\tdata: bodyFormData,\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'multipart/form-data',\r\n\t\t\t\tAuthorization: password,\r\n\t\t\t},\r\n\t\t})\r\n\t\t\t.then((operation) => {\r\n\t\t\t\tdocument.getElementsByClassName('loading' + count)[0].style.display = 'none';\r\n\t\t\t\tsuccessMessage('Website uploaded to address : ' + operation.data.address);\r\n\t\t\t})\r\n\r\n\t\t\t.catch((e) => {\r\n\t\t\t\tdocument.getElementsByClassName('loading' + count)[0].style.display = 'none';\r\n\t\t\t\terrorAlert(getErrorMessage(e.response.data.code));\r\n\t\t\t});\r\n\t};\r\n}\r\n\r\n$('#file-select-button').click(function () {\r\n\t$('.upload input').click();\r\n});\r\n\r\n// change button text with file name\r\n$('.upload input').on('change', function () {\r\n\tlet str = $('.upload input').val();\r\n\r\n\tlet n = str.lastIndexOf('\\\\');\r\n\r\n\tlet result = str.substring(n + 1);\r\n\r\n\t$('#file-select-button').html(result);\r\n});\r\n\r\n//check if file is .zip\r\n$('.upload input').on('change', function () {\r\n\tlet str = $('.upload input').val();\r\n\r\n\tlet n = str.lastIndexOf('.');\r\n\r\n\tlet result = str.substring(n + 1);\r\n\r\n\tif (result != 'zip' && $('.upload input').val() != '') {\r\n\t\tuploadable = false;\r\n\r\n\t\tdocument.getElementsByClassName('fileError')[0].style.display = 'flex';\r\n\t\tdocument.getElementById('website-upload').style.display = 'none';\r\n\t\tdocument.getElementById('website-upload-refuse').style.display = 'flex';\r\n\t} else {\r\n\t\tuploadable = true;\r\n\t\tdocument.getElementsByClassName('fileError')[0].style.display = 'none';\r\n\t\tdocument.getElementById('website-upload').style.display = 'flex';\r\n\t\tdocument.getElementById('website-upload-refuse').style.display = 'none';\r\n\t}\r\n});\r\n\r\n//remove label of input website name on focus\r\n$('.website-dns input').on('focus', function () {\r\n\tdocument.getElementById('website-info-display').style.visibility = 'hidden';\r\n});\r\n\r\n//check if input string is valid\r\n$('.website-dns input').on('change', function () {\r\n\tlet str = $('.website-dns input').val();\r\n\tlet pattern = new RegExp('^[a-z0-9]+$');\r\n\tlet testPattern = pattern.test(str);\r\n\r\n\tif (testPattern == false) {\r\n\t\tuploadable = false;\r\n\t\tdocument.getElementsByClassName('dns-error')[0].style.display = 'flex';\r\n\t\tdocument.getElementById('website-upload').style.display = 'none';\r\n\t\tdocument.getElementById('website-upload-refuse').style.display = 'flex';\r\n\t} else {\r\n\t\tuploadable = true;\r\n\t\tdocument.getElementsByClassName('dns-error')[0].style.display = 'none';\r\n\t\tdocument.getElementById('website-upload').style.display = 'flex';\r\n\t\tdocument.getElementById('website-upload-refuse').style.display = 'none';\r\n\t}\r\n});\r\n\r\nfunction deployWebsiteAndUpload(password) {\r\n\tif (uploadable == true) {\r\n\t\tlet defaultWallet = getDefaultWallet();\r\n\t\tconst dnsNameInputValue = document.getElementById('websiteName').value;\r\n\r\n\t\tconst file = document.querySelector('.upload input').files[0];\r\n\t\tconst bodyFormData = new FormData();\r\n\t\tbodyFormData.append('url', dnsNameInputValue);\r\n\t\tbodyFormData.append('nickname', defaultWallet);\r\n\t\tbodyFormData.append('zipfile', file);\r\n\r\n\t\tconst reader = new FileReader();\r\n\t\treader.readAsDataURL(file);\r\n\t\treader.onloadend = (_) => {\r\n\t\t\tconst result = reader.result.length;\r\n\r\n\t\t\tconst chunkSize = Math.floor(result / 260_000) + 1;\r\n\r\n\t\t\tstepper(dnsNameInputValue, chunkSize, true);\r\n\r\n\t\t\taxios({\r\n\t\t\t\turl: `/websiteCreator/prepare`,\r\n\t\t\t\tmethod: 'put',\r\n\t\t\t\tdata: bodyFormData,\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t'Content-Type': 'multipart/form-data',\r\n\t\t\t\t\tAuthorization: password,\r\n\t\t\t\t},\r\n\t\t\t})\r\n\t\t\t\t.then((operation) => {\r\n\t\t\t\t\tsuccessMessage('Website uploaded to address : ' + operation.data.address);\r\n\t\t\t\t\tgetWebsiteDeployerSC();\r\n\t\t\t\t})\r\n\t\t\t\t.catch((e) => {\r\n\t\t\t\t\terrorAlert(getErrorMessage(e.response.data.code));\r\n\t\t\t\t});\r\n\t\t};\r\n\t}\r\n}\r\n\r\nasync function stepper(dnsName, totalChunk, isFullProcess) {\r\n\tinitStepper(dnsName, totalChunk);\r\n\tif (isFullProcess) {\r\n\t\tstep1(dnsName, totalChunk);\r\n\t} else {\r\n\t\t$('.circle').eq(0).empty();\r\n\t\t$('.circle').eq(0).append('<i class=\"bi bi-check\">');\r\n\t\t$('.title').eq(0).removeClass('loading-dots');\r\n\t\tstep3(getDeployerByDns(dnsName).address, totalChunk);\r\n\t}\r\n}\r\n\r\nfunction initStepper(dnsName, totalChunk) {\r\n\t$('.website-card').hide();\r\n\t$('.stepper').show();\r\n\r\n\t$('.stepper-title').html('Deployment of ' + dnsName);\r\n\t$('.title').eq(0).addClass('loading-dots');\r\n\r\n\t$('.title')\r\n\t\t.eq(2)\r\n\t\t.text('Chunk upload ' + 1 + ' on ' + totalChunk);\r\n}\r\n\r\nfunction step1(dnsName, totalChunk) {\r\n\teventManager.subscribe(\r\n\t\t`Website Deployer is deployed at :`,\r\n\t\tgetWallet(getDefaultWallet()).address,\r\n\t\t(resp) => step2(dnsName, resp.data.data.split(':')[1], totalChunk)\r\n\t);\r\n}\r\n\r\nfunction step2(dnsName, contractAddress, totalChunk) {\r\n\teventManager.subscribe(\r\n\t\t`Resolver set to record key :record${dnsName}at address `,\r\n\t\tgetWallet(getDefaultWallet()).address,\r\n\t\t(_) => {\r\n\t\t\tstep3(contractAddress, totalChunk);\r\n\t\t}\r\n\t);\r\n\r\n\t$('.circle').eq(0).empty();\r\n\t$('.circle').eq(0).append('<i class=\"bi bi-check\">');\r\n\r\n\t$('.title').eq(0).removeClass('loading-dots');\r\n\t$('.title').eq(1).addClass('loading-dots');\r\n}\r\n\r\nfunction step3(contractAddress, totalChunk) {\r\n\tlet actualChunk = 1;\r\n\r\n\tfor (let i = 0; i < totalChunk; i++) {\r\n\t\tif (i === 0) {\r\n\t\t\teventManager.subscribe(\r\n\t\t\t\t`First chunk deployed to ${contractAddress}`,\r\n\t\t\t\tgetWallet(getDefaultWallet()).address,\r\n\t\t\t\t(_) => {\r\n\t\t\t\t\tactualChunk++;\r\n\t\t\t\t\t$('.title')\r\n\t\t\t\t\t\t.eq(2)\r\n\t\t\t\t\t\t.text('Chunk upload ' + actualChunk + ' on ' + totalChunk);\r\n\t\t\t\t\t$('.title').eq(2).addClass('loading-dots');\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t} else if (i == totalChunk - 1) {\r\n\t\t\teventManager.subscribe(\r\n\t\t\t\t`Append chunk deployed to ${contractAddress} : ${totalChunk - 1}`,\r\n\t\t\t\tgetWallet(getDefaultWallet()).address,\r\n\t\t\t\t(_) => {\r\n\t\t\t\t\tresetStepper();\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\teventManager.subscribe(\r\n\t\t\t\t`Append chunk deployed to ${contractAddress} : ${i}`,\r\n\t\t\t\tgetWallet(getDefaultWallet()).address,\r\n\t\t\t\t(_) => {\r\n\t\t\t\t\tactualChunk++;\r\n\t\t\t\t\t$('.title')\r\n\t\t\t\t\t\t.eq(2)\r\n\t\t\t\t\t\t.text('Chunk upload ' + actualChunk + ' on ' + totalChunk);\r\n\t\t\t\t\t$('.title').eq(2).addClass('loading-dots');\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\t$('.circle').eq(1).empty();\r\n\t$('.circle').eq(1).append('<i class=\"bi bi-check\">');\r\n\r\n\t$('.title').eq(1).removeClass('loading-dots');\r\n\t$('.title').eq(2).addClass('loading-dots');\r\n}\r\n\r\nfunction resetStepper() {\r\n\t$('.website-card').show();\r\n\t$('.stepper').hide();\r\n\r\n\t$('.circle').empty();\r\n\t$('.circle').eq(0).html('1');\r\n\t$('.circle').eq(1).html('2');\r\n\t$('.circle').eq(2).html('3');\r\n\r\n\t$('.title').eq(2).html('Chunk upload');\r\n\r\n\t$('.title').eq(2).removeClass('loading-dots');\r\n}\r\n"
